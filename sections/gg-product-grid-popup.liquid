{{ 'component-card.css' | asset_url | stylesheet_tag }}
{{ 'component-price.css' | asset_url | stylesheet_tag }}

{% if section.settings.image_shape == 'blob' %}
  {{ 'mask-blobs.css' | asset_url | stylesheet_tag }}
{%- endif -%}

{%- unless section.settings.quick_add == 'none' -%}
  {{ 'quick-add.css' | asset_url | stylesheet_tag }}
{%- endunless -%}

{%- if section.settings.quick_add == 'standard' -%}
  <script src="{{ 'quick-add.js' | asset_url }}" defer="defer"></script>
{%- elsif section.settings.quick_add == 'bulk' -%}
  <script src="{{ 'quick-add-bulk.js' | asset_url }}" defer="defer"></script>
  <script src="{{ 'quick-add.js' | asset_url }}" defer="defer"></script>
{%- endif -%}

<section class="gg-product-grid-quickadd color-{{ section.settings.color_scheme }} gradient" id="gg-grid-{{ section.id }}">
  <div class="page-width">
    {%- if section.settings.heading != blank -%}
      <div class="title-wrapper-with-link">
        <h2 class="title inline-richtext">{{ section.settings.heading }}</h2>
      </div>
    {%- endif -%}

    <div class="gg-grid" role="list">
      {%- for i in (1..6) -%}
        {%- assign key = 'product_' | append: i -%}
        {%- assign product_handle = section.settings[key] -%}
        {%- if product_handle != blank -%}
          {%- assign product = all_products[product_handle] -%}
          {%- if product != blank -%}
            <div class="gg-grid__item" role="listitem">
              {% render 'card-product',
                card_product: product,
                media_aspect_ratio: section.settings.image_ratio,
                image_shape: section.settings.image_shape,
                show_secondary_image: section.settings.show_secondary_image,
                show_vendor: section.settings.show_vendor,
                show_rating: section.settings.show_rating,
                lazy_load: true,
                quick_add: section.settings.quick_add,
                section_id: section.id
              %}
            </div>
          {%- endif -%}
        {%- endif -%}
      {%- endfor -%}
    </div>
  </div>

  {%- if section.settings.quick_add != 'none' -%}
    <modal-dialog id="QuickAdd-{{ section.id }}" class="quick-add-modal gg-quickadd-modal">
      <div
        role="dialog"
        aria-label="{{ 'products.product.choose_product_options' | t }}"
        aria-modal="true"
        class="quick-add-modal__content global-settings-popup"
        tabindex="-1"
      >
        <button
          id="ModalClose-{{ section.id }}"
          type="button"
          class="quick-add-modal__toggle"
          aria-label="{{ 'accessibility.close' | t }}"
        >
          {{- 'icon-close.svg' | inline_asset_content -}}
        </button>

        <div id="QuickAddInfo-{{ section.id }}" class="quick-add-modal__content-info"></div>
      </div>
    </modal-dialog>
  {%- endif -%}
</section>

<style>
  #gg-grid-{{ section.id }} .gg-grid{
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 18px;
  }

  #gg-grid-{{ section.id }} .gg-grid__item{
    min-width: 0;
  }

  @media (max-width: 989px){
    #gg-grid-{{ section.id }} .gg-grid{
      grid-template-columns: repeat(2, 1fr);
    }
  }

  @media (max-width: 480px){
    #gg-grid-{{ section.id }} .gg-grid{
      grid-template-columns: 1fr;
    }
  }

  #gg-grid-{{ section.id }} .gg-quickadd-modal .quick-add-modal__content{
    width: min(420px, calc(100vw - 24px));
    max-width: 420px;
  }

  #gg-grid-{{ section.id }} .gg-quickadd-modal .quick-add-modal__content-info{
    padding: 14px;
  }

  #gg-grid-{{ section.id }} .gg-quickadd-modal .product__title{
    margin: 0 0 8px;
  }

  #gg-grid-{{ section.id }} .gg-quickadd-modal .price{
    margin-bottom: 10px;
  }
</style>

{% schema %}
{
  "name": "GG Product Grid",
  "settings": [
    { "type": "text", "id": "heading", "label": "Heading", "default": "Tisso vison in the wild" },

    { "type": "color_scheme", "id": "color_scheme", "label": "Color scheme", "default": "background-1" },

    {
      "type": "select",
      "id": "image_ratio",
      "options": [
        { "value": "square", "label": "Square" },
        { "value": "portrait", "label": "Portrait" },
        { "value": "landscape", "label": "Landscape" }
      ],
      "default": "square",
      "label": "Image ratio"
    },
    {
      "type": "select",
      "id": "image_shape",
      "options": [
        { "value": "default", "label": "Default" },
        { "value": "blob", "label": "Blob" }
      ],
      "default": "default",
      "label": "Image shape"
    },

    { "type": "checkbox", "id": "show_secondary_image", "default": true, "label": "Show secondary image" },
    { "type": "checkbox", "id": "show_vendor", "default": false, "label": "Show vendor" },
    { "type": "checkbox", "id": "show_rating", "default": false, "label": "Show rating" },

    {
      "type": "select",
      "id": "quick_add",
      "label": "Quick add",
      "default": "standard",
      "options": [
        { "value": "none", "label": "None" },
        { "value": "standard", "label": "Standard" },
        { "value": "bulk", "label": "Bulk" }
      ]
    },

    { "type": "product", "id": "product_1", "label": "Product 1" },
    { "type": "product", "id": "product_2", "label": "Product 2" },
    { "type": "product", "id": "product_3", "label": "Product 3" },
    { "type": "product", "id": "product_4", "label": "Product 4" },
    { "type": "product", "id": "product_5", "label": "Product 5" },
    { "type": "product", "id": "product_6", "label": "Product 6" }
  ],
  "presets": [
    { "name": "GG Product Grid" }
  ]
}
{% endschema %}
